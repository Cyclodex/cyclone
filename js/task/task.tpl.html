<div
     ng-show="$ctrl.user.username"
     class="container"
     layout="row" layout-align="center center">
    <div flex="100"
         flex-gt-md="80">
        <md-toolbar>
            <div class="md-toolbar-tools">
                <h1 class="inline">
                    <span>Cyclone</span>
                    <a ui-sref="time">Time</a>
                    <span> - </span>
                    <a ui-sref="task">Task</a>
                    <span ng-if="nextDateLink"> - Archive</span>
                </h1>
                <span flex></span>
                <a ng-href="{{prevDateLink}}">
                    <md-icon>keyboard_arrow_left</md-icon>
                </a>
                <h1 ng-if="!nextDateLink" class="inline">{{currentDate | date : "d. MMM yyyy"}}</h1>
                <h1 ng-if="nextDateLink" class="inline">{{currentDate | date : "EEE d. MMM yyyy"}}</h1>
                <a ng-if="nextDateLink" ng-href="{{nextDateLink}}">
                    <md-icon>keyboard_arrow_right</md-icon>
                </a>
            </div>
        </md-toolbar>

        <md-card ng-if="$ctrl.error">
            <md-card-title>
                <div class="md-headline">
                    Error
                </div>
            </md-card-title>
            <md-card-content>
                {{$ctrl.error}}
            </md-card-content>
        </md-card>

        <!-- Add new entry -->
        <md-card flex="nogrow">
            <md-card-title>
                <div class="md-headline">
                    <div ng-if="!$ctrl.newEntryManualTime.value">
                        <span>What have you done in the last</span>
                        <em>{{ $ctrl.currentDuration | humanizeDate }}</em>
                    </div>
                    <div ng-if="$ctrl.newEntryManualTime.value">
                        <span>What have you done until {{$ctrl.newEntryManualTime.value | date : "H:mm"}}</span>
                    </div>
                </div>
            </md-card-title>
            <md-card-content>
                <form ng-submit="$ctrl.addEntry()" layout="row" name="addEntryForm">
                    <md-input-container flex="20">
                        <input id="newTaskProject"
                               type="text"
                               ng-model="$ctrl.newEntryProject"
                               autofocus
                               focus-on="newTaskProject"
                               aria-label="Project name of new task">
                        <label for="newTaskProject">Project</label>
                    </md-input-container>

                    <md-input-container flex="15">
                        <input id="newTaskName"
                               type="text"
                               ng-model="$ctrl.newEntryTask"
                               aria-label="Task">
                        <label for="newTaskName">Task</label>
                    </md-input-container>

                    <md-input-container flex="33">
                        <input id="newTaskText"
                               type="text"
                               ng-model="$ctrl.newEntryText"
                               aria-label="Description text of new task">
                        <label for="newTaskText">Description</label>
                    </md-input-container>

                    <md-input-container>
                        <label>Type</label>
                        <md-select id="newTaskType"
                                   ng-model="$ctrl.newEntryType"
                                   aria-label="Type of entry"
                                   ng-keydown="$event.which === 13 && addEntry()">
                            <md-option ng-repeat="type in $ctrl.timeTypesService" ng-value="type.value">
                                {{type.name}}
                            </md-option>
                        </md-select>
                    </md-input-container>

                    <md-input-container flex="15">
                        <input type="time"
                               id="newTaskManualTime"
                               name="input"
                               ng-model="$ctrl.newEntryManualTime.value"
                               placeholder="HH:mm" min="00:00:00" max="24:00:00"/>
                        <label for="newTaskManualTime">Manual end time</label>
                    </md-input-container>
                    <div class="flex">
                        <a class=""
                           ng-click="$ctrl.addEntry()">
                            <md-button class="md-fab md-primary" aria-label="Add Entry">
                                <md-icon>add</md-icon>
                            </md-button>
                        </a>
                    </div>

                    <button type="submit" class="submitbutton hide">Submit</button>
                </form>
            </md-card-content>
        </md-card>

        <!--<div class="task__entries">
            <div ng-repeat="entry in $ctrl.entries"
                 layout="column"
                 layout-align="stretch center"
                 class="row project-type&#45;&#45;{{entry.type}}"
                 ng-class="[{true: 'done', false: ''}[entry.checked == true]]"
            >
                &lt;!&ndash;<div ng-if="!$last || entry.type !== 'system'"&ndash;&gt;
                <div class="entry"
                     layout="row">
                    <md-card layout="column"
                             layout-align="space-around"
                             layout-gt-xs="row"
                             flex="none"
                             class="entry-card"
                             ng-class="[{true: 'done', false: ''}[entry.checked == true]]">
                        <div class="entry__checked">
                            &lt;!&ndash; Checkbox in front of the line &ndash;&gt;
                            <md-button
                                    clipboard
                                    class="entry__checked__button md-raised md-primary md-button md-ink-ripple"
                                    ng-if="!entry.checked"
                                    text="entry.timestampDuration / 1000 / 60 / 60 | number : 2"
                                    on-copied="copySuccess(); updateSingleEntry(entry);"
                                    on-error="copyFail(err)"
                                    aria-label="Check entry and copy time"
                                    class="md-raised md-button md-ink-ripple">
                                <md-tooltip md-direction="left">
                                    Check & copy time
                                </md-tooltip>
                                {{ entry.timestampDuration / 1000 / 60 / 60 | number : 2 }} h
                            </md-button>
                            <md-button
                                    ng-if="entry.checked"
                                    class="entry__checked__button"
                                    ng-click="entry.checked = false; $ctrl.entries.$save(entry);"
                                    aria-label="remove check from entry">
                                <md-tooltip md-direction="left">
                                    Uncheck
                                </md-tooltip>
                                <md-icon
                                        class="material-icons md-primary"
                                >check_box</md-icon>
                            </md-button>
                        </div>

                        &lt;!&ndash; Project &ndash;&gt;
                        <md-input-container md-no-float class="entry__info__input entry__info__input&#45;&#45;project">
                            <input ng-model="entry.project"
                                   ng-change="$ctrl.entries.$save(entry)"
                                   id="project"
                                   type="text"
                                   aria-label="project"
                                   placeholder="Project"
                                   autocomplete="Project"/>
                        </md-input-container>

                        &lt;!&ndash; Showing the task name assigned (group)&ndash;&gt;
                        <md-input-container md-no-float class="entry__info__input entry__info__input&#45;&#45;task md-icon-float md-icon-left">
                            <input ng-model="entry.group"
                                   ng-change="$ctrl.entries.$save(entry)"
                                   id="group"
                                   type="text"
                                   class="validate"
                                   aria-label="Task"
                                   placeholder="Task"/>
                        </md-input-container>

                        &lt;!&ndash; Description&ndash;&gt;
                        &lt;!&ndash; TODO: Description is not listed for every group, but groups list all descriptions of all entries&ndash;&gt;
                        &lt;!&ndash;<md-input-container md-no-float class="entry__info__input entry__info__input&#45;&#45;text">
                            <input ng-model="entry.text"
                                   ng-change="$ctrl.entries.$save(entry)"
                                   id="text"
                                   type="text"
                                   class="validate"
                                   aria-label="Description"
                                   placeholder="Description"
                                   autocomplete="Description"/>
                        </md-input-container>&ndash;&gt;

                        &lt;!&ndash; Entry type &ndash;&gt;
                        <div class="entry__type">
                            <md-input-container>
                                &lt;!&ndash;<label>Type</label>&ndash;&gt;
                                <md-select ng-model="entry.type"
                                           aria-label="Type of entry"
                                           ng-keydown="$event.which === 13 && addEntry()">
                                    <md-option ng-repeat="type in $ctrl.timeTypesService" ng-value="type.value">
                                        {{type.name}}
                                    </md-option>
                                </md-select>
                            </md-input-container>
                        </div>

                        &lt;!&ndash; Time information &ndash;&gt;
                        <div class="entry__time-information" layout=row layout-align="start center">
                            <div class="duration duration&#45;&#45;human">
                                <span>{{ entry.timestampDuration | humanizeDate  }}</span>
                            </div>
                        </div>

                        &lt;!&ndash; Actions &ndash;&gt;
                        <div layout=column layout-align="start">
                            <div class="entry__options">
                                <div layout=row layout-align="space-around center">
                                    &lt;!&ndash; Copy button &ndash;&gt;
                                    <div>
                                        <a class=""
                                           ng-click="$ctrl.cloneEntry(entry)">
                                            <md-button class="md-fab md-primary md-mini" aria-label="Use task">
                                                <md-tooltip md-direction="top">
                                                    Use this project & description for current timer
                                                </md-tooltip>
                                                <md-icon>add</md-icon>
                                            </md-button>
                                        </a>
                                    </div>

                                    &lt;!&ndash; Continue button &ndash;&gt;
                                    <div>
                                        <a class=""
                                           ng-click="$ctrl.continueEntry(entry)">
                                            <md-button class="md-fab md-primary md-mini" aria-label="Continue Task">
                                                <md-tooltip md-direction="top">
                                                    Track current timer and continue now on this task
                                                </md-tooltip>
                                                <md-icon>play_arrow</md-icon>
                                            </md-button>
                                        </a>
                                    </div>
                                    <div>
                                        <md-button ng-click="$ctrl.deleteEntry(entry);"
                                                   class="md-fab md-mini"
                                                   aria-label="Delete entry">
                                            <md-tooltip md-direction="top">
                                                Delete
                                            </md-tooltip>
                                            <md-icon>delete_forever</md-icon>
                                        </md-button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </md-card>
                </div>
            </div>

        </div>-->

        <div class="cyclone-table cyclone-table--tasks" flex="grow">
            <div class="md-toolbar-tools">
                <h1>
                    <md-icon>featured_play_list</md-icon> Open Tasks
                </h1>
            </div>

            <div layout="row" layout-sm="column" layout-align="space-around" ng-if="!$ctrl.doneLoading">
                <md-progress-circular md-mode="indeterminate"></md-progress-circular>
            </div>

            <md-card layout="row" ng-repeat="(Group, GroupData) in $ctrl.entriesCurrentGroups | orderObjectBy:'checkedState':false"
                     ng-if="GroupData.group"
                     layout-align="start stretch"
                     class="card task project-type--{{GroupData.type}}" >

                    <!-- Checkbox -->
                    <!-- TODO: The checkbox does not copy the correct time, because its updated already so it seems. -->
                    <div class="task__checkbox">
                        <md-checkbox aria-label="GroupsChecked"
                                     ng-checked="GroupData.checkedState"
                                     md-indeterminate="GroupData.indeterminate"
                                     clipboard
                                     text="GroupData.durationNotChecked / 1000 / 60 / 60 | number : 2"
                                     on-copied="$ctrl.copySuccess(); $ctrl.updateGroupStatus(GroupData)"
                                     on-error="$ctrl.copyFail(err)"
                                     class="md-primary">
                        </md-checkbox>
                        <md-tooltip md-direction="top">
                            <span ng-if="!GroupData.checkedState">Check all</span>
                            <span ng-if="GroupData.checkedState">Un-check all</span>
                        </md-tooltip>
                    </div>

                    <div class="entry entry--group" layout="column">
                        <div class="entry__info" layout="row" layout-align="start center">

                            <!-- Detail toggler -->
                            <md-button class="group__time-information__details md-icon-button"
                                       ng-click="$ctrl.toggleDetails(GroupData)"
                                       aria-label="Toggle display of details">
                                <div ng-if="!GroupData.showDetails">
                                    <md-tooltip md-direction="top">
                                        Show details
                                    </md-tooltip>
                                    <md-icon ng-if="!GroupData.showDetails">keyboard_arrow_down</md-icon>
                                </div>
                                <div ng-if="GroupData.showDetails">
                                    <md-tooltip md-direction="top">
                                        Hide details
                                    </md-tooltip>
                                    <md-icon ng-if="GroupData.showDetails">keyboard_arrow_up</md-icon>
                                </div>
                            </md-button>

                            <!-- Project -->
                            <md-input-container md-no-float class="entry__info__input entry__info__input--project">
                                <input ng-model="GroupData.project"
                                       ng-change="$ctrl.updateGroupData(GroupData)"
                                       type="text"
                                       aria-label="project"
                                       placeholder="Project"
                                       autocomplete="Project"
                                       ng-model-options="{updateOn: 'blur'}"
                                />
                            </md-input-container>

                            <!-- Task name -->
                            <md-input-container md-no-float class="entry__info__input entry__info__input--task">
                                <input ng-model="GroupData.task"
                                       ng-change="$ctrl.updateGroupData(GroupData)"
                                       type="text"
                                       aria-label="Task"
                                       placeholder="Task"
                                       autocomplete="Task"
                                       ng-model-options="{updateOn: 'blur'}"
                                />
                            </md-input-container>

                            <!-- Type -->
                            <md-input-container md-no-float class="entry__info__select entry__info__select--type">
                                <md-select ng-model="GroupData.type"
                                           aria-label="Type of the entry"
                                           ng-change="$ctrl.updateGroupData(GroupData)" >
                                    <md-option ng-repeat="type in $ctrl.timeTypesService" ng-value="type.value">
                                        {{type.name}}
                                    </md-option>
                                </md-select>
                            </md-input-container>

                            <!-- Time information -->
                            <div flex="grow" layout="row" layout-align="start center" class="entry__info__time-information">
                                <div ng-if="GroupData.indeterminate">
                                    <md-icon>warning</md-icon>
                                </div>
                                <div>
                                    <div ng-if="GroupData.durationNotChecked > 0">
                                        <span ng-if="GroupData.indeterminate">Un-checked time:</span>
                                        <span class="duration duration--decimal">
                                            <span
                                                    clipboard
                                                    text="GroupData.durationNotChecked / 1000 / 60 / 60 | number : 2"
                                                    on-copied="$ctrl.copySuccess();"
                                                    on-error="$ctrl.copyFail(err)"
                                                    class="">
                                                <!-- on-copied+= $ctrl.updateGroupStatus(GroupData, true); -->
                                                <strong>{{ GroupData.durationNotChecked / 1000 / 60 / 60 | number : 2 }}</strong> h
                                            </span>
                                        </span>
                                        <span>in {{ GroupData.amountNotChecked }} slots</span>
                                    </div>
                                    <div ng-if="GroupData.durationChecked > 0">
                                        <span class="duration duration--decimal">
                                            <!-- TODO: Verify if we really should force an update, even when the group is "indeterminate". -->
                                            <span ng-if="GroupData.indeterminate">Checked time:</span>
                                            <span
                                                clipboard
                                                text="GroupData.durationChecked / 1000 / 60 / 60 | number : 2"
                                                on-copied="$ctrl.copySuccess();"
                                                on-error="$ctrl.copyFail(err)"
                                                class="done">
                                                <md-tooltip md-direction="bottom">
                                                    Copy time
                                                </md-tooltip>
                                                {{ GroupData.durationChecked / 1000 / 60 / 60 | number : 2 }} h
                                            </span>
                                        </span>
                                        <span>in {{ GroupData.amountChecked }} slots</span>
                                    </div>
                                </div>
                            </div>


                            <!-- Continue button -->
                            <!-- LETS SIMPLIFY THE GUI and disable the continue button -->
                            <!--<span>
                                <md-button class="md-fab md-primary md-mini"
                                           aria-label="Continue Group"
                                           ng-click="$ctrl.continueGroup(GroupData)">
                                        <md-tooltip md-direction="top"><span>Track current timer and continue now on this Group</span></md-tooltip>
                                        <md-icon>play_arrow</md-icon>
                                    </md-button>
                            </span>-->
                            <!-- Add button -->
                            <!-- TODO: On tasks we also have to push the PROJECT name, otherwise it will be strange mixed -->
                            <div class="entry__actions"
                                 flex="nogrow">
                                <md-button class="md-fab md-primary md-mini"
                                           aria-label="Add current timer to this Group"
                                           ng-click="$ctrl.addEntryToGroup(GroupData)">
                                    <md-tooltip md-direction="top">
                                        Track current timer into this group
                                    </md-tooltip>
                                    <md-icon>playlist_add</md-icon>
                                </md-button>
                            </div>


                        </div> <!-- END of entry__info -->
                        <div class="entry__details"
                             layout="row"
                             layout-align="start start"
                             ng-if="GroupData.showDetails">
                            <!-- entries -->
                            <div ng-repeat="(entryKey, entry) in GroupData.tasks"
                                 layout="row"
                                 layout-align="start stretch"
                                 layout-align-gt-md="space-around stretch"
                                 class="entry task__group__entry project-type--{{entry.type}}"
                                 ng-class="{true: 'task__group__entry--done', false: ''}[entry.checked == true]"
                            >
                                <md-card
                                        layout=row
                                        layout-align="center center"
                                        flex="none"
                                >
                                    <div layout=column layout-align="space-between">
                                        <md-input-container md-no-float class="entry__info__input entry__info__input--text">
                                            <input ng-model="entry.text"
                                                   ng-change="$ctrl.updateEntry(entryKey, entry)"
                                                   type="text"
                                                   class="validate"
                                                   aria-label="Task description"
                                                   placeholder="Task description"
                                                   autocomplete="task description"/>
                                        </md-input-container>
                                        <div class="entry__time-information">
                                            <div class="duration duration--human">
                                                <span>{{ entry.timestampDuration | humanizeDate  }}</span>
                                                <span>&nbsp;|&nbsp;</span>
                                                <span class="duration duration--decimal">
                                                <!-- timediff / miliseconds (1000) / minutes(60) / calculate decimal hours (60) -->
                                                <strong>{{ entry.timestampDuration / 1000 / 60 / 60 | number : 2 }}</strong> h</span>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Delete task entry -->
                                    <md-button ng-click="$ctrl.deleteEntryHelper(entryKey)"
                                               class="task__group__entry__delete"
                                               aria-label="Delete entry">
                                        <md-tooltip md-direction="top">
                                            Delete task
                                        </md-tooltip>
                                        <md-icon>close</md-icon>
                                    </md-button>
                                </md-card>
                            </div>
                        </div>
                    </div>
            </md-card>
        </div>
        <!-- END: cyclone-table-->

        <pre>
            {{ $ctrl.entriesCurrentGroups | json }}
        </pre>
    </div>


    <!--
    <pre>{{ data | json }}</pre>
    <pre>{{ profile | json }}</pre>
    -->
</div>
