<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="robots" content="noindex">
    <title>Cyclone</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Styling files -->
    <link rel="stylesheet prefetch" href="//fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900">
    <link rel="stylesheet prefetch" href="//fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet prefetch" href="//ajax.googleapis.com/ajax/libs/angular_material/1.1.0-rc2/angular-material.min.css">
    <link rel="stylesheet prefetch" href="//fonts.googleapis.com/icon?family=Material+Icons">

    <!-- Our styling files -->
    <link rel="stylesheet" href="build/cyclone.css">

    <!-- Favicons -->
    <link rel="apple-touch-icon" sizes="180x180" href="img/favicons/apple-touch-icon.png">
    <link rel="icon" type="image/png" href="img/favicons/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="img/favicons/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="img/favicons/manifest.json">
    <link rel="mask-icon" href="img/favicons/safari-pinned-tab.svg" color="#3f51b5">
    <link rel="shortcut icon" href="img/favicons/favicon.ico">
    <meta name="apple-mobile-web-app-title" content="Cyclone">
    <meta name="application-name" content="Cyclone">
    <meta name="msapplication-config" content="img/favicons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">

</head>

<body translate="no">

<div ng-app="cycloneApp" class="page page--timelog">
    <!-- Login button -->
    <div ng-if="!user"
         layout="column"
         layout-align="center center"
         class="login">
        <h1>Cyclone</h1>
        <a id="loginButton"
           href="authentication.html"
           target="_parent"
           class=""
           ng-show="!user">
            <md-button class="md-raised md-primary" aria-label="Login">Login</md-button>
        </a>
    </div>

    <div ng-cloak ng-controller="TimeCtrl"
     ng-show="user"
     class="container"
     layout="row" layout-align="center center">
        <div flex="100"
             flex-gt-md="80">
            <md-toolbar>
                <div class="md-toolbar-tools">
                    <h1 class="inline">
                        <a ng-href="#today">Cyclone</a>
                        <span ng-if="nextDateLink"> - Archive</span>
                    </h1>
                    <span flex></span>
                    <a ng-href="{{prevDateLink}}">
                        <md-icon>keyboard_arrow_left</md-icon>
                    </a>
                    <h1 ng-if="!nextDateLink" class="inline">{{currentDate | date : "d. MMM yyyy"}}</h1>
                    <h1 ng-if="nextDateLink" class="inline">{{currentDate | date : "EEE d. MMM yyyy"}}</h1>
                    <a ng-if="nextDateLink" ng-href="{{nextDateLink}}">
                        <md-icon>keyboard_arrow_right</md-icon>
                    </a>
                </div>
            </md-toolbar>

            <md-card ng-if="error">
                <md-card-title>
                    <div class="md-headline">
                        Error
                    </div>
                </md-card-title>
                <md-card-content>
                    {{error}}
                </md-card-content>
            </md-card>

            <!-- Add new entry -->
            <md-card class="animate-hide" ng-hide="!addEntryEnabled"
                flex="nogrow">
                <md-card-title>
                    <div class="md-headline">
                        <div ng-if="!newEntryManualTime.value">
                            <span>What have you done in the last</span>
                            <span ng-if="currentDurationHasHours">
                            <em>{{ currentDuration | date : "H'h' m'min'" : '+0000'}}</em> ?
                        </span>
                            <span ng-if="!currentDurationHasHours">
                            <em>{{ currentDuration | date : "m:ss" :  '+0000'}} Minutes</em> ?
                        </span>
                        </div>
                        <div ng-if="newEntryManualTime.value">
                            <span>What have you done until {{newEntryManualTime.value | date : "H:mm"}}</span>
                        </div>
                    </div>
                </md-card-title>
                <md-card-content>
                    <form ng-submit="addEntry()" layout="row" name="addEntryForm">
                        <md-input-container flex="20">
                            <input id="newTaskProject"
                                   type="text"
                                   ng-model="newEntryProject"
                                   autofocus
                                   focus-on="newTaskProject"
                                   aria-label="Project name of new task">
                            <label for="newTaskProject">Project</label>
                        </md-input-container>
                        <md-input-container flex="33">
                            <input id="newTaskText"
                                   type="text"
                                   ng-model="newEntryText"
                                   aria-label="Description text of new task">
                            <label for="newTaskText">Description</label>
                        </md-input-container>

                        <md-input-container flex="15">
                            <input type="time"
                                   id="newTaskManualTime"
                                   name="input"
                                   ng-model="newEntryManualTime.value"
                                   placeholder="HH:mm" min="00:00:00" max="24:00:00"/>
                            <label for="newTaskManualTime">Manual end time</label>
                        </md-input-container>
                        <div class="flex">
                            <a class=""
                               ng-click="addEntry()">
                                <md-button class="md-fab md-primary" aria-label="Add Entry">
                                    <md-icon>add</md-icon>
                                </md-button>
                            </a>
                        </div>

                        <button type="submit" class="submitbutton hide">Submit</button>
                    </form>
                </md-card-content>
            </md-card>


            <!-- Show table of entries-->
            <div class="timelog__entries"
            layout="column"
            layout-align="start center"
            layout-gt-sm="row"
            layout-align-gt-sm="start start"
            >

                <div class="cyclone-table timeline" flex="none">
                    <md-toolbar>
                        <div class="md-toolbar-tools">
                            <h1>Timeline</h1>
                        </div>
                    </md-toolbar>

                    <div layout="row" layout-sm="column" layout-align="space-around" ng-if="!doneLoading">
                        <md-progress-circular md-mode="indeterminate"></md-progress-circular>
                    </div>

                    <!-- List of timelog entries-->
                    <div ng-repeat="entry in entries"
                         layout="column"
                         layout-align="start center"
                     class="row project-type--{{entry.type}}"
                     ng-class="[{true: 'done', false: ''}[entry.checked == true]]"
                    >
                        <div ng-if="$last && entry.type == 'system'"
                             class="entry start-of-day"
                             layout="row">
                            <div class="entry__timestamp" flex="none">
                                {{ entry.timestamp | date:'HH:mm' }}
                            </div>
                            <md-card layout="column"
                                     layout-align="space-around"
                                     layout-gt-xs="row"
                                     flex="none">
                                <div>
                                    {{entry.text}}
                                </div>
                                <div class="entry__options">
                                    <md-button ng-click="deleteEntry();"
                                               class="md-fab md-mini"
                                               aria-label="Delete entry">
                                        <md-tooltip md-direction="top">
                                            Delete
                                        </md-tooltip>
                                        <md-icon>delete_forever</md-icon>
                                    </md-button>
                                </div>
                            </md-card>
                        </div>


                        <div ng-if="!$last || entry.type !== 'system'"
                             class="entry"
                             layout="row">
                            <div class="entry__timestamp" flex="none">
                                {{ entry.timestamp | date:'HH:mm' }}
                            </div>
                            <md-card layout="column"
                                     layout-align="space-around"
                                     layout-gt-xs="row"
                                     flex="none">
                                <div class="entry__time-information" layout=column layout-align="center center">
                                    <div class="duration duration--human">
                                        <span>{{ entry.timestampDuration | date : "H'h' m'min'" : '+0000' }}</span>
                                    </div>
                                    <div class="duration duration--decimal">
                                        <md-button
                                         clipboard
                                         text="entry.timestampDuration / 1000 / 60 / 60 | number : 2"
                                         on-copied="copySuccess(); updateSingleEntry(entry);"
                                         on-error="copyFail(err)"
                                         class="md-raised md-button md-ink-ripple">
                                            <md-tooltip md-direction="bottom">
                                                Copy time
                                            </md-tooltip>
                                            {{ entry.timestampDuration / 1000 / 60 / 60 | number : 2 }} h
                                        </md-button>
                                    </div>
                                </div>
                                <div class="entry__checked">
                                    <md-checkbox ng-model="entry.checked"
                                                 aria-label="checked"
                                                 ng-change="entries.$save(entry)"
                                                 class="md-primary">
                                    </md-checkbox>
                                </div>
                                <div class="entry__info">
                                    <md-input-container class="entry__info__input entry__info__input--project">
                                        <input ng-model="entry.project"
                                         ng-change="entries.$save(entry)"
                                         id="project"
                                         type="text"
                                         aria-label="project"/>
                                    </md-input-container>
                                    <md-input-container class="entry__info__input entry__info__input--text">
                                        <input ng-model="entry.text"
                                         ng-change="entries.$save(entry)"
                                         id="text"
                                         type="text"
                                         class="validate"
                                         aria-label="Description"/>
                                    </md-input-container>
                                </div>
                                <!-- Entry type -->
                                <div>
                                    <md-radio-group
                                     ng-model="entry.type"
                                     ng-change="entries.$save(entry)"
                                     aria-label="Work or private hours"
                                    >
                                        <md-radio-button value="work" class="md-primary">Work</md-radio-button>
                                        <md-radio-button value="internal" class="md-primary">Internal</md-radio-button>
                                        <md-radio-button value="private">Private</md-radio-button>
                                    </md-radio-group>
                                </div>
                                <!-- entry actions -->
                                <div layout=column layout-align="space-between">
                                    <div class="entry__options">
                                        <div layout=row layout-align="space-around center">

                                            <div>
                                                <a class=""
                                                   ng-click="cloneEntry()">
                                                    <md-button class="md-fab md-primary md-mini" aria-label="Use task">
                                                        <md-tooltip md-direction="top">
                                                            Use this project & description for current timer
                                                        </md-tooltip>
                                                        <md-icon>content_copy</md-icon>
                                                    </md-button>
                                                </a>
                                            </div>
                                            <div ng-if="addEntryEnabled">
                                                <a class=""
                                                   ng-click="continueEntry(entry.project, entry.text)">
                                                    <md-button class="md-fab md-primary md-mini" aria-label="Continue Task">
                                                        <md-tooltip md-direction="top">
                                                            Track current timer and continue now on this task
                                                        </md-tooltip>
                                                        <md-icon>play_arrow</md-icon>
                                                    </md-button>
                                                </a>
                                            </div>
                                            <div>
                                                <md-button ng-click="deleteEntry();"
                                                           class="md-fab md-mini"
                                                           aria-label="Delete entry">
                                                    <md-tooltip md-direction="top">
                                                        Delete
                                                    </md-tooltip>
                                                    <md-icon>delete_forever</md-icon>
                                                </md-button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </md-card>
                        </div>
                    </div>
                </div>

                <div class="cyclone-table cyclone-table--grouped" flex="grow">
                    <md-toolbar>
                        <div class="md-toolbar-tools">
                            <h1>Continued tasks</h1>
                        </div>
                    </md-toolbar>

                    <div layout="row" layout-padding layout-sm="column" layout-align="space-around" ng-if="!doneLoading">
                        <md-progress-circular md-mode="indeterminate"></md-progress-circular>
                    </div>

                    <div ng-repeat="(project, projectData) in entriesCurrentGroups">
                        <md-subheader class="md-primary">{{project}}</md-subheader>
                        <div layout="row" layout-wrap layout-align="start stretch">
                            <md-card ng-repeat="(Task, TaskData) in projectData"
                                 ng-if="TaskData.amount > 1"
                                 layout="column"
                                 layout-padding
                                 layout-align="start stretch"
                                 class="project-card">
                                <div>
                                    <strong>{{Task}}</strong>
                                    <a class="continue-task-now"
                                       ng-if="addEntryEnabled"
                                       ng-click="continueEntry(project, Task)">
                                        <md-button class="md-fab md-primary md-mini" aria-label="Continue Task">
                                            <md-tooltip md-direction="top">
                                                Track current timer and continue now on this task
                                            </md-tooltip>
                                            <md-icon>play_arrow</md-icon>
                                        </md-button>
                                    </a>
                                </div>
                                <md-subheader class="md-secondary entry__time-information" flex="none">
                                    <span>Checked time:</span>
                                    <span class="duration duration--human">
                                        <span>{{ TaskData.durationChecked | date : "H'h' m'min'" : '+0000' }}</span>
                                    </span>
                                    <span class="duration duration--decimal">
                                        <!-- TODO: Verify if we really should force an update, even when the group is "indeterminate". -->
                                        <md-button
                                         clipboard
                                         text="TaskData.durationChecked / 1000 / 60 / 60 | number : 2"
                                         on-copied="copySuccess(); updateGroup(TaskData, true);"
                                         on-error="copyFail(err)"
                                         class="md-raised md-button md-ink-ripple">
                                            <md-tooltip md-direction="bottom">
                                                Copy time
                                            </md-tooltip>
                                            {{ TaskData.durationChecked / 1000 / 60 / 60 | number : 2 }} h
                                        </md-button>
                                    </span>
                                </md-subheader>
                                <md-subheader class="md-primary entry__time-information">
                                    <span>Un-checked time:</span>
                                    <span class="duration duration--human">
                                        <span>{{ TaskData.duration | date : "H'h' m'min'" : '+0000' }}</span>
                                    </span>
                                    <span class="duration duration--decimal">
                                        <md-button
                                         clipboard
                                         text="TaskData.duration / 1000 / 60 / 60 | number : 2"
                                         on-copied="copySuccess(); updateGroup(TaskData, true);"
                                         on-error="copyFail(err)"
                                         class="md-raised md-button md-ink-ripple">
                                            <md-tooltip md-direction="bottom">
                                                Copy time
                                            </md-tooltip>
                                            <strong>{{ TaskData.duration / 1000 / 60 / 60 | number : 2 }}</strong> h
                                        </md-button>
                                    </span>
                                </md-subheader>
                            <div layout="column"
                                 layout-align="center stretch"
                                 layout-gt-sm="row"
                                 layout-align-gt-sm="space-around center"
                            >
                                <div layout="column"
                                     layout-align="center stretch">
                                    <div class="entry__checked"
                                         layout=row
                                         layout-align="center center">
                                        <md-checkbox aria-label="TasksChecked"
                                                     ng-click="updateGroup(TaskData);"
                                                     ng-checked="TaskData.checkedState"
                                                     md-indeterminate="TaskData.indeterminate"
                                                     class="md-primary">
                                        </md-checkbox>
                                        <md-tooltip md-direction="top">
                                            <span ng-if="!TaskData.checkedState">Check all</span>
                                            <span ng-if="TaskData.checkedState">Un-check all</span>
                                        </md-tooltip>
                                    </div>
                                </div>
                                <div layout="column"
                                     layout-align="center stretch">
                                    <div ng-repeat="entry in TaskData.tasks"
                                         layout="row"
                                         layout-align="start stretch"
                                         layout-align-gt-md="space-around stretch"
                                         class="entry"
                                         ng-class="[{true: 'work', false: 'private'}[entry.type == 'work'],
                                      {true: 'done', false: ''}[entry.checked == true]
                                      ]"
                                    >
                                        <div class="entry__timestamp" flex="none">
                                            <div class="entry__timestamp__end">
                                                {{ entry.timestamp | date:'HH:mm' }}
                                            </div>
                                            <div class="entry__timestamp__start">
                                                {{ entry.timestampStart | date:'HH:mm' }}
                                            </div>
                                        </div>
                                        <md-card
                                                layout=row
                                                layout-align="center center"
                                                flex="none"
                                        >
                                            <!-- entry actions -->
                                            <div layout=column layout-align="space-between">
                                                <div class="entry__time-information" layout=row layout-align="center center">
                                                    <div class="duration duration--human">
                                                        <span>{{ entry.timestampDuration | date : "H'h' m'min'" : '+0000' }}</span>
                                                    </div>
                                                    <div>&nbsp;|&nbsp;</div>
                                                    <div class="duration duration--decimal">
                                                        <!-- timediff / miliseconds (1000) / minutes(60) / calculate decimal hours (60) -->
                                                        <strong>{{ entry.timestampDuration / 1000 / 60 / 60 | number : 2 }}</strong> h
                                                    </div>
                                                </div>
                                            </div>
                                        </md-card>
                                    </div>
                                </div>
                            </div>
                        </md-card>
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <!-- <pre>{{ data | json }}</pre>
        <pre>{{ profile | json }}</pre> -->
    </div>

    <footer-display class="footer-stats" ng-cloak></footer-display>

</div>

<!-- Cyclone app -->
<script src="build/vendors.js"></script>
<script src="build/cyclone.js"></script>
</body>
</html>
