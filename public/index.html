<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="robots" content="noindex">
    <title>Cyclone</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Styling files -->
    <link rel="stylesheet prefetch" href="//fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900">
    <link rel="stylesheet prefetch" href="//fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet prefetch" href="//ajax.googleapis.com/ajax/libs/angular_material/1.1.0-rc2/angular-material.min.css">
    <link rel="stylesheet prefetch" href="//fonts.googleapis.com/icon?family=Material+Icons">

    <!-- Our styling files -->
    <link rel="stylesheet" href="build/cyclone.css">

    <!-- Favicons -->
    <link rel="apple-touch-icon" sizes="180x180" href="img/favicons/apple-touch-icon.png">
    <link rel="icon" type="image/png" href="img/favicons/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="img/favicons/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="img/favicons/manifest.json">
    <link rel="mask-icon" href="img/favicons/safari-pinned-tab.svg" color="#3f51b5">
    <link rel="shortcut icon" href="img/favicons/favicon.ico">
    <meta name="apple-mobile-web-app-title" content="Cyclone">
    <meta name="application-name" content="Cyclone">
    <meta name="msapplication-config" content="img/favicons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">

</head>

<body translate="no">

<div ng-app="cycloneApp" class="page page--timelog">
    <md-toolbar ng-cloak ng-controller="ConnectionCtrl">
        <div class="header__status md-toolbar-tools">
            <span>Status:&nbsp;</span>
            <span class="status">
                {{ connection }}
            </span>
            <span flex></span>
            <div class="header__version right">
                <a href="https://github.com/Cyclodex/cyclone/blob/master/CHANGELOG.md" title="Go to github page" target="_blank">
                    Version: {{ version }} <strong>BETA</strong>
                </a>
            </div>
        </div>
    </md-toolbar>

    <div ng-controller="ProfileCtrl" class="card-content white-text"
         layout="row">
        <a ng-click="ProfileOpen = !ProfileOpen" class="profileLink">
            <md-icon>account_circle</md-icon>
            <span>{{ user }}</span>
        </a>
        <div ng-show="ProfileOpen || !user" id="ProfileOpen">
            <div id="account-details" ng-show="userIsAdmin"></div>
            <a id="loginButton"
               href="authentication.html"
               target="_parent"
               class=""
               ng-show="!user">
                <md-button class="md-raised md-primary" aria-label="Login">Login</md-button>
            </a>
            <a id="logoutButton"
               ng-click="logout()"
               class=""
               ng-show="user">
                <md-button class="md-raised md-primary" aria-label="Login">Logout</md-button>
            </a>
        </div>

        <!--Data: <pre>{{ profile | json }}</pre>-->
    </div>

    <div ng-cloak ng-controller="TimeCtrl"
     ng-show="user"
     class="container"
     layout="row" layout-align="center center">
        <div flex="100"
             flex-gt-md="80">
            <md-toolbar>
                <div class="md-toolbar-tools">
                    <h1 class="inline">
                        <a ng-href="#today">Timelog</a>
                        <span ng-if="nextDateLink"> - Archive</span>
                    </h1>
                    <span flex></span>
                    <a ng-href="{{prevDateLink}}">
                        <md-icon>keyboard_arrow_left</md-icon>
                    </a>
                    <h1 ng-if="!nextDateLink" class="inline">{{currentDate | date : "d. MMM yyyy"}}</h1>
                    <h1 ng-if="nextDateLink" class="inline">{{currentDate | date : "EEE d. MMM yyyy"}}</h1>
                    <a ng-if="nextDateLink" ng-href="{{nextDateLink}}">
                        <md-icon>keyboard_arrow_right</md-icon>
                    </a>
                </div>
            </md-toolbar>

            <md-card ng-if="error">
                <md-card-title>
                    <div class="md-headline">
                        Error
                    </div>
                </md-card-title>
                <md-card-content>
                    {{error}}
                </md-card-content>
            </md-card>

            <!-- Add new entry -->
            <md-card class="animate-hide" ng-hide="!addEntryEnabled">
                <md-card-title>
                    <div class="md-headline">
                        <div ng-if="!newEntryManualTime.value">
                            <span>What have you done in the last</span>
                            <span ng-if="currentDurationHasHours">
                            <em>{{ currentDuration | date : "H'h' m'min'" : '+0000'}}</em> ?
                        </span>
                            <span ng-if="!currentDurationHasHours">
                            <em>{{ currentDuration | date : "m:ss" :  '+0000'}} Minutes</em> ?
                        </span>
                        </div>
                        <div ng-if="newEntryManualTime.value">
                            <span>What have you done until {{newEntryManualTime.value | date : "H:mm"}}</span>
                        </div>
                    </div>
                </md-card-title>
                <md-card-content>
                    <form ng-submit="addEntry()" layout="row" name="addEntryForm">
                        <md-input-container flex="33">
                            <input id="newTaskText"
                                   type="text"
                                   ng-model="newEntryText"
                                   autofocus
                                   focus-on="newTaskText"
                                   aria-label="Description text of new task">
                            <label for="newTaskText">Description</label>
                        </md-input-container>
                        <md-input-container flex="20">
                            <input id="newTaskProject"
                                   type="text"
                                   ng-model="newEntryProject"
                                   aria-label="Project name of new task">
                            <label for="newTaskProject">Project</label>
                        </md-input-container>

                        <md-input-container flex="15">
                            <input type="time"
                                   id="newTaskManualTime"
                                   name="input"
                                   ng-model="newEntryManualTime.value"
                                   placeholder="HH:mm" min="00:00:00" max="24:00:00"/>
                            <label for="newTaskManualTime">Manual end time</label>
                        </md-input-container>
                        <div class="flex">
                            <a class=""
                               ng-click="addEntry()">
                                <md-button class="md-fab md-primary" aria-label="Add Entry">
                                    <md-icon>add</md-icon>
                                </md-button>
                            </a>
                        </div>

                        <button type="submit" class="submitbutton hide">Submit</button>
                    </form>
                </md-card-content>
            </md-card>


            <!-- Show table of entries-->
            <div class="timelog__entries"
            layout="column"
            layout-align="start center"
            layout-gt-sm="row"
            layout-align-gt-sm="start start"
            >

                <div class="cyclone-table timeline" flex="none">
                    <md-toolbar>
                        <div class="md-toolbar-tools">
                            <h1>Timeline</h1>
                        </div>
                    </md-toolbar>

                    <div layout="row" layout-sm="column" layout-align="space-around" ng-if="!doneLoading">
                        <md-progress-circular md-mode="indeterminate"></md-progress-circular>
                    </div>

                    <!-- List of timelog entries-->
                    <div ng-repeat="entry in entries"
                         layout="column"
                         layout-align="start center"
                     class="row"
                     ng-class="[{true: 'work', false: 'private'}[entry.type == 'work'],
                      {true: 'done', false: ''}[entry.checked == true]
                      ]"
                    >
                        <div ng-if=$last
                             class="entry start-of-day"
                             layout="row">
                            <div class="entry__timestamp" flex="none">
                                {{ entry.timestamp | date:'HH:mm' }}
                            </div>
                            <md-card>
                                {{entry.text}}
                            </md-card>
                            <!-- Don't delete the last element, would act nicely.
                            <div>
                                <md-button ng-click="deleteEntry();"
                                           class="md-fab md-mini"
                                           aria-label="Delete entry">
                                    <md-tooltip md-direction="top">
                                        Delete
                                    </md-tooltip>
                                    <md-icon>delete_forever</md-icon>
                                </md-button>
                            </div> -->
                        </div>


                        <div ng-if=!$last
                             class="entry"
                             layout="row">
                            <div class="entry__timestamp" flex="none">
                                {{ entry.timestamp | date:'HH:mm' }}
                            </div>
                            <md-card layout="column"
                                     layout-align="space-around"
                                     layout-gt-xs="row"
                                     flex="none">
                                <div class="entry__checked">
                                    <md-checkbox ng-model="entry.checked"
                                                 aria-label="checked"
                                                 ng-change="entries.$save(entry)"
                                                 class="md-primary">
                                    </md-checkbox>
                                </div>
                                <div class="entry__info">
                                    <md-input-container class="entry__info__input entry__info__input--project">
                                        <input ng-model="entry.project"
                                         ng-change="entries.$save(entry)"
                                         id="project"
                                         type="text"
                                         aria-label="project"/>
                                    </md-input-container>
                                    <md-input-container class="entry__info__input entry__info__input--text">
                                        <input ng-model="entry.text"
                                         ng-change="entries.$save(entry)"
                                         id="text"
                                         type="text"
                                         class="validate"
                                         aria-label="Description"/>
                                    </md-input-container>
                                </div>
                                <!-- entry actions -->
                                <div layout=column layout-align="space-between">
                                    <div class="entry__options">
                                        <div layout=row layout-align="space-around center">
                                            <div>
                                                <md-switch ng-model="entry.type"
                                                           aria-label="Work or private hours"
                                                           ng-true-value="'work'"
                                                           ng-false-value="'private'"
                                                           class="md-primary"
                                                           ng-change="entries.$save(entry)">
                                                    {{ entry.type }}
                                                </md-switch>
                                            </div>
                                            <div>
                                                <a class=""
                                                   ng-click="cloneEntry()">
                                                    <md-button class="md-fab md-mini" aria-label="Use task">
                                                        <md-tooltip md-direction="top">
                                                            Use this project & description for current timer
                                                        </md-tooltip>
                                                        <md-icon>content_copy</md-icon>
                                                    </md-button>
                                                </a>
                                            </div>
                                            <div>
                                                <a class=""
                                                   ng-click="continueEntry()">
                                                    <md-button class="md-fab md-mini" aria-label="Continue Task">
                                                        <md-tooltip md-direction="top">
                                                            Track current timer and continue now on this task
                                                        </md-tooltip>
                                                        <md-icon>update</md-icon>
                                                    </md-button>
                                                </a>
                                            </div>
                                            <div>
                                                <md-button ng-click="deleteEntry();"
                                                           class="md-fab md-mini"
                                                           aria-label="Delete entry">
                                                    <md-tooltip md-direction="top">
                                                        Delete
                                                    </md-tooltip>
                                                    <md-icon>delete_forever</md-icon>
                                                </md-button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="entry__time-information" layout=row layout-align="center center">
                                        <div class="duration duration--human">
                                            <span>{{ entry.timestampDuration | date : "H'h' m'min'" : '+0000' }}</span>
                                        </div>
                                        <div>&nbsp;|&nbsp;</div>
                                        <div class="duration duration--decimal">
                                            <!-- timediff / miliseconds (1000) / minutes(60) / calculate decimal hours (60) -->
                                            <strong>{{ entry.timestampDuration / 1000 / 60 / 60 | number : 2 }}</strong> h
                                        </div>
                                    </div>
                                </div>
                            </md-card>
                        </div>
                    </div>
                </div>

                <div class="cyclone-table cyclone-table--grouped" flex="grow">
                    <md-toolbar>
                        <div class="md-toolbar-tools">
                            <h1>Continued Tasks</h1>
                        </div>
                    </md-toolbar>

                    <div layout="row" layout-padding layout-sm="column" layout-align="space-around" ng-if="!doneLoading">
                        <md-progress-circular md-mode="indeterminate"></md-progress-circular>
                    </div>

                    <div ng-repeat="(project, projectData) in entriesCurrentGroups">
                        <md-subheader class="md-primary">{{project}}</md-subheader>
                        <div layout="row" layout-wrap layout-align="start stretch">
                            <md-card ng-repeat="(Task, TaskData) in projectData"
                                 ng-if="TaskData.amount > 1"
                                 layout="column"
                                 layout-padding
                                 layout-align="start stretch"
                                 class="project-card">
                            <strong>{{Task}}</strong>
                            <!--<div class="entry__time-information">-->
                                <md-subheader class="md-secondary" flex="none">
                                    <span>Checked time:</span>
                                    <span class="duration duration--human">
                                        <span>{{ TaskData.durationChecked | date : "H'h' m'min'" : '+0000' }}</span>
                                    </span>
                                    <span>&nbsp;|&nbsp;</span>
                                    <span class="duration duration--decimal">
                                        <!-- timediff / miliseconds (1000) / minutes(60) / calculate decimal hours (60) -->
                                        <strong>{{ TaskData.durationChecked / 1000 / 60 / 60 | number : 2 }}</strong> h
                                    </span>
                                </md-subheader>
                            <!--</div>-->
                            <!--<div class="entry__time-information">-->
                                <md-subheader class="md-primary">
                                    <span>Un-checked time:</span>
                                    <span class="duration duration--human">
                                        <span>{{ TaskData.duration | date : "H'h' m'min'" : '+0000' }}</span>
                                    </span>
                                    <span>&nbsp;|&nbsp;</span>
                                    <span class="duration duration--decimal">
                                        <!-- timediff / miliseconds (1000) / minutes(60) / calculate decimal hours (60) -->
                                        <strong>{{ TaskData.duration / 1000 / 60 / 60 | number : 2 }}</strong> h
                                    </span>
                                </md-subheader>
                            <!--</div>-->
                            <div layout="column"
                                 layout-align="center stretch"
                                 layout-gt-sm="row"
                                 layout-align-gt-sm="space-around center"
                            >
                                <div layout="column"
                                     layout-align="center stretch">
                                    <div class="entry__checked"
                                         layout=row
                                         layout-align="center center">
                                        <md-checkbox aria-label="TasksChecked"
                                                     ng-click="updateGroup(TaskData);"
                                                     ng-checked="TaskData.checkedState"
                                                     md-indeterminate="TaskData.indeterminate"
                                                     class="md-primary">
                                        </md-checkbox>
                                        <md-tooltip md-direction="top">
                                            <span ng-if="!TaskData.checkedState">Check all</span>
                                            <span ng-if="TaskData.checkedState">Un-check all</span>
                                        </md-tooltip>
                                    </div>
                                </div>
                                <div layout="column"
                                     layout-align="center stretch">
                                    <div ng-repeat="entry in TaskData.tasks"
                                         layout="row"
                                         layout-align="start stretch"
                                         layout-align-gt-md="space-around stretch"
                                         class="entry"
                                         ng-class="[{true: 'work', false: 'private'}[entry.type == 'work'],
                                      {true: 'done', false: ''}[entry.checked == true]
                                      ]"
                                    >
                                        <div class="entry__timestamp" flex="none">
                                            <div class="entry__timestamp__end">
                                                {{ entry.timestamp | date:'HH:mm' }}
                                            </div>
                                            <div class="entry__timestamp__start">
                                                {{ entry.timestampStart | date:'HH:mm' }}
                                            </div>
                                        </div>
                                        <md-card
                                                layout=row
                                                layout-align="center center"
                                                flex="none"
                                        >
                                            <!-- entry actions -->
                                            <div layout=column layout-align="space-between">
                                                <div class="entry__time-information" layout=row layout-align="center center">
                                                    <div class="duration duration--human">
                                                        <span>{{ entry.timestampDuration | date : "H'h' m'min'" : '+0000' }}</span>
                                                    </div>
                                                    <div>&nbsp;|&nbsp;</div>
                                                    <div class="duration duration--decimal">
                                                        <!-- timediff / miliseconds (1000) / minutes(60) / calculate decimal hours (60) -->
                                                        <strong>{{ entry.timestampDuration / 1000 / 60 / 60 | number : 2 }}</strong> h
                                                    </div>
                                                </div>
                                            </div>
                                        </md-card>
                                    </div>
                                </div>
                            </div>
                        </md-card>
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <!-- <pre>{{ data | json }}</pre>
        <pre>{{ profile | json }}</pre> -->
    </div>

    <footer ng-cloak ng-controller="StatsCtrl" class="footer-stats">
        <md-toolbar class="footer-stats__totals stats-totals md-toolbar-tools"
                    layout="row" layout-align="center center">
            <div><strong>Total:</strong></div>
            <div>Work: {{statsTotalWork | date : "H'h' m'min'" : '+0000'}}</div>
            <div class="footer-stats__private">Private: {{statsTotalPrivate | date : "H'h' m'min'" : '+0000'}}</div>
        </md-toolbar>
        <md-toolbar
                ng-show="user"
                class="container footer-stats__details md-toolbar-tools"
                layout="column" layout-align="center stretch">

            <div class="stats-title">
                <strong>Tasks</strong>
            </div>
            <div class="day-visualize">
                <md-button ng-repeat="entry in refDayVisArray | orderObjectBy:'order':true"
                           class="dayVisualize-entry project--{{entry.project}}"
                           ng-class="[
                    {true: 'checked--yes', false: 'checked--no'}[entry.checked == true],
                    {true: 'work', false: 'private'}[entry.type == 'work'],
                 ]"
                           ng-style="{'background-color':'' + entry._color + '', 'flex-grow':'' + entry._width + ''}"
                           aria-label="info">
                    <md-tooltip md-direction="top">
                        {{entry.project}}: {{entry.text}}
                    </md-tooltip>
                    <div class="dayVisualize-entry-content dayVisualize-entry-content--text">{{entry.text}}</div>
                    <div class="dayVisualize-entry-content dayVisualize-entry-content--duration">{{entry.timestampDuration | date : "H'h' m'min'" : '+0000'}}</div>
                    <div class="dayVisualize-entry-content dayVisualize-entry-content--time-start">{{entry.timestampStart | date:'H:mm'}}</div>
                    <div ng-if=$last class="dayVisualize-entry-content dayVisualize-entry-content--time-end">{{entry.timestamp | date:'H:mm'}}</div>
                </md-button>
            </div>

            <div class="stats-title">
                <strong>Project total</strong>
            </div>
            <div class="day-visualize project-sum">
                <md-button ng-repeat="entry in dayVisualizeProjectTotals track by $index"
                           class="dayVisualize-entry project--{{entry.project}}"
                           ng-class="[
                    {true: 'work', false: 'private'}[entry.type == 'work'],
                 ]"
                           ng-style="{'background-color':'' + entry._color + '', 'flex-grow':'' + entry._width + ''}"
                           aria-label="info">
                    </md-tooltip>
                    <div class="dayVisualize-entry-content dayVisualize-entry-content--project">{{entry.project}}</div>
                    <div class="dayVisualize-entry-content dayVisualize-entry-content--time">{{entry.duration | date : "H'h' m'min'" : '+0000'}}</div>
                </md-button>
            </div>

        </md-toolbar>
    </footer>

</div>


<!-- AngularJS 1.5.x -->
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.8/angular.min.js"></script>

<!-- Firebase 3.x -->
<script src="https://www.gstatic.com/firebasejs/3.3.2/firebase.js"></script>
<script src="https://www.gstatic.com/firebasejs/3.3.2/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/3.3.2/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/3.3.2/firebase-database.js"></script>


<!-- AngularFire 2.x -->
<script src="https://cdn.firebase.com/libs/angularfire/2.0.2/angularfire.min.js"></script>

<!-- Moment js (TODO: check angular implementation )-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.13.0/moment.min.js"></script>

<!-- Angular JS 1.5 modules -->
<script src="//ajax.googleapis.com/ajax/libs/angularjs/1.5.3/angular-route.min.js"></script>
<script src="//ajax.googleapis.com/ajax/libs/angularjs/1.5.3/angular-animate.min.js"></script>
<script src="//ajax.googleapis.com/ajax/libs/angularjs/1.5.3/angular-aria.min.js"></script>
<script src="//ajax.googleapis.com/ajax/libs/angularjs/1.5.3/angular-messages.min.js"></script>

<!-- Angular Material -->
<script src="//ajax.googleapis.com/ajax/libs/angular_material/1.1.0-rc2/angular-material.min.js"></script>

<!-- Random Colors -->
<script src="//cdnjs.cloudflare.com/ajax/libs/randomcolor/0.4.4/randomColor.min.js"></script>

<!-- Cyclone app -->
<script src="build/cyclone.js"></script>

</body>
</html>
